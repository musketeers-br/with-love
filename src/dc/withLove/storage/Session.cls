Class dc.withLove.storage.Session Extends %Persistent
{

Property CreatedAt As %DateTime [ InitialExpression = {$ZDateTime($Horolog, 3)} ];

/// The original user prompt
Property UserPrompt As %String(MAXLEN = "");

/// The SDA XML generated by AI (stored as Stream to support large volumes)
Property GeneratedSDA As %Stream.GlobalCharacter;

/// The resulting FHIR JSON (for cache and audit)
Property ResultFHIR As %Stream.GlobalCharacter;

/// Processing status
Property ProcessingStatus As %String(VALUELIST = ",Created,Processed,Error") [ InitialExpression = "Created" ];

Index StatusIdx On ProcessingStatus;

Storage Default
{
<Data name="SessionDefaultData">
<Value name="1">
<Value>%%CLASSNAME</Value>
</Value>
<Value name="2">
<Value>CreatedAt</Value>
</Value>
<Value name="3">
<Value>UserPrompt</Value>
</Value>
<Value name="4">
<Value>GeneratedSDA</Value>
</Value>
<Value name="5">
<Value>ResultFHIR</Value>
</Value>
<Value name="6">
<Value>ProcessingStatus</Value>
</Value>
</Data>
<DataLocation>^dc.withLove.storage.SessionD</DataLocation>
<DefaultData>SessionDefaultData</DefaultData>
<IdLocation>^dc.withLove.storage.SessionD</IdLocation>
<IndexLocation>^dc.withLove.storage.SessionI</IndexLocation>
<StreamLocation>^dc.withLove.storage.SessionS</StreamLocation>
<Type>%Storage.Persistent</Type>
}

}
